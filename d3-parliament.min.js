d3.parliament=function(){function t(t){t.each(function(t){e=e||this.getBoundingClientRect().width,n=e?e/2:this.getBoundingClientRect().width/2;var u=Math.min(e/2,n),c=u*a,s=d3.select(this),f=0;t.forEach(function(t){f+="number"==typeof t.seats?Math.floor(t.seats):t.seats.length});var m=0,h=0,d=.5;!function(){for(var t=a/(1-a);h<f;)m++,d+=t,h=r(function(t){return Math.floor(Math.PI*(d+t))},m-1)}();var g=(u-c)/m,p=[];!function(){for(var t=h-f,r=0;r<m;r++)for(var e=c+g*(r+.5),n=Math.floor(Math.PI*(d+r))-Math.floor(t/m)-(t%m>r?1:0),a=Math.PI/n,o=0;o<n;o++){var i={};i.polar={r:e,teta:-Math.PI+a*(o+.5)},i.cartesian={x:i.polar.r*Math.cos(i.polar.teta),y:i.polar.r*Math.sin(i.polar.teta)},p.push(i)}}(),p.sort(function(t,r){return t.polar.teta-r.polar.teta||r.polar.r-t.polar.r}),function(){var r=0,e=0;p.forEach(function(n){var a=t[r],o="number"==typeof a.seats?a.seats:a.seats.length;e>=o&&(r++,e=0,a=t[r]),n.party=a,n.data="number"==typeof a.seats?null:a.seats[e],e++})}();var v=function(t){var r="seat ";return r+=t.party&&t.party.id||"",r.trim()},C=function(t){return t.cartesian.x},y=function(t){return t.cartesian.y},M=function(t){var r=.4*g;return t.data&&"number"==typeof t.data.size&&(r*=t.data.size),r},T=s.select(".parliament");T.empty()&&(T=s.append("g"),T.classed("parliament",!0)),T.attr("transform","translate("+e/2+","+u+")");var b=T.selectAll(".seat").data(p);b.attr("class",v);var x=b.enter().append("circle");if(x.attr("class",v),x.attr("cx",o.fromCenter?0:C),x.attr("cy",o.fromCenter?0:y),x.attr("r",o.smallToBig?0:M),o.fromCenter||o.smallToBig){var B=x.transition().duration(function(){return 1e3+800*Math.random()});o.fromCenter&&(B.attr("cx",C),B.attr("cy",y)),o.smallToBig&&B.attr("r",M)}for(var S in l._)!function(t){x.on(t,function(r){l.call(t,this,r)})}(S);if(b.transition().duration(function(){return 1e3+800*Math.random()}).attr("cx",C).attr("cy",y).attr("r",M),i.toCenter||i.bigToSmall){var B=b.exit().transition().duration(function(){return 1e3+800*Math.random()});i.toCenter&&B.attr("cx",0).attr("cy",0),i.bigToSmall&&B.attr("r",0),B.remove()}else b.exit().remove()})}function r(t,r){for(var e=0,n=0;n<=r;n++)e+=t(n);return e}var e,n,a=.4,o={smallToBig:!0,fromCenter:!0},i={bigToSmall:!0,toCenter:!0},l=d3.dispatch("click","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","touchcancel","touchend","touchmove","touchstart");return t.width=function(r){return arguments.length?(e=r,t):e},t.height=function(r){return arguments.length?(n=r,t):n},t.innerRadiusCoef=function(r){return arguments.length?(a=r,t):a},t.enter={smallToBig:function(r){return arguments.length?(o.smallToBig=r,t.enter):o.smallToBig},fromCenter:function(r){return arguments.length?(o.fromCenter=r,t.enter):o.fromCenter}},t.exit={bigToSmall:function(r){return arguments.length?(i.bigToSmall=r,t.exit):i.bigToSmall},toCenter:function(r){return arguments.length?(i.toCenter=r,t.exit):i.toCenter}},t.on=function(t,r){l.on(t,r)},t};